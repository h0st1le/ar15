
;
; This program does part of the milling of an AR-15 lower receiver.
;
; It is based on the information in chapter 3 of "Machining the AR15 Lower
; Receiver Forging" by Ray Brandes, available from from Ray-Vin.com.
;
; In this setup we'll drill and ream the holes and mill the pockets on the
; driver's side.
;
; The receiver forging is held in the vise, clamped on the deck and the
; trigger guard bosses, with the driver's side up.  The passenger side is
; up off the vise so we can drill and ream through-holes without nicking
; the vise.  The surface of the driver's side that has the two safety stop
; bumps is just above the level of the jaws, so we can mill all the way out
; to the edge of the casting at that level.
;
; The butt face is on the right (+X), at X=7.500, deck is on the +Y side at
; 0.250.
;
; The operations for this setup consist of 8 holes [spot-drilled, drilled,
; and some reamed] and 4 milling operations [slots & pockets].
;
; One of the holes is extra troublesome - it needs a spot face for the
; drill to start on, and it's at the bottom of one of the milled slots.
; The part geometry here imposes an order on the operations: spot-face,
; make the hole, then mill the slot.
;
; The rest of the ops are independent of each other, so they can happen in
; any convenient order.  The holes should be made from smallest to biggest,
; so we can open up the bigger holes gradually with bigger and bigger
; drills.
;
; The sequence of operations are thus:
;
;     1.  spot-face for the bolt release hole [5/32 or smaller center
;         cutting end mill]
;
;     2.  spot-drill all 8 holes [spot drill]
;
;     3.  drill all 8 holes .125 [finishes: rear trigger guard hole] [1/8
;         drill]
;
;     4.  drill all 7 remaining holes with a #24 drill, .152, pre-drill for
;         .156 reamer [#24 drill]
;
;     5.  ream trigger hole, hammer hole, and bolt release spring hole to
;         5/32 [finishes: trigger hole, hammer hole, bolt release spring
;         hole] [5/32 reamer]
;
;     6.  drill all 4 remaining holes with a #5 drill [finishes: mag
;         release hole] [#5 drill]
;
;     7.  drill all 3 remaining holes with a D drill [D drill]
;
;     8.  ream pivot pin hole and hammer pin hole with a .251 reamer
;         [finishes pivot pin hole and hammer pin hole] [.251 reamer]
;
;     9.  drill safety selector hole with a U drill, .368, pre-drill for
;         .376 reamer [U drill]
;
;     10. ream safety selector hole to .376 [finishes: safety selector
;         hole] [.376 reamer]
;
;     11. mill bolt release slot [5/32 or 1/8 end mill]
;
;     12. mill safety stops [1/4 end mill or so]
;
;     13. mill mag release slot [1/4 end mill]
;
;     14. mill pistol grip pocket [1/2 end mill]
;
;
; Tools used:
; 
;     drills & reamers:
;
;         spot drill
;
;         .125 drill
;
;         #24 drill (pre-drill for .156, 5/32, reamer)
;         .156 (5/32) reamer
;
;         #5 drill (0.2055" diameter)
;
;         D drill (pre-drill for 0.251 reamer)
;         .251 reamer
;
;         U drill (pre-drill for .376 reamer)
;         .376 reamer
;
;     end mills:
;
;         5/32 end mill (0.156) (or a 1/8, .125, might work, must be center cutting)
;         1/4 end mill (0.250)
;         1/2 end mill (0.500)
;


#<SafeZ> = 2
#<ThroughZ> = -1.400


#<DoSpotFaceBoltReleaseSpringHole> = 1
    #<SpotFaceBoltReleaseSpringHoleToolNumber> = 1 ; FIXME: 1/8" 2-flute center-cutting end-mill
    #<SpotFaceSpeed> = 2500
    #<SpotFaceFeed> = 7


#<DoSpotDrilling> = 1
    #<SpotDrillToolNumber> = 2 ; FIXME: 1/4" spotting drill
    #<SpotDrillSpeed> = 3000
    #<SpotDrillFeed> = 5


#<Do.125Drilling> = 1
    #<.125DrillToolNumber> = 3 ; FIXME: 1/8" drill
    #<.125DrillSpeed> = 3000
    #<.125DrillFeed> = [.125 * 100]  ; FIXME


#<DoN24Drilling> = 1
    #<N24DrillToolNumber> = 4 ; FIXME: #24 drill (.152)
    #<N24DrillSpeed> = 3000
    #<N24DrillFeed> = [.152 * 100]  ; FIXME


#<Do.156Reaming> = 1
    #<.156ReamerToolNumber> = 5 ; FIXME: .156 reamer
    #<.156ReamerSpeed> = 400
    #<.156ReamerFeed> = [.156 * 100]  ; FIXME


#<DoN5Drilling> = 1
    #<N5DrillToolNumber> = 6 ; FIXME: #5 drill (.2055)
    #<N5DrillSpeed> = 3000
    #<N5DrillFeed> = [.2055 * 100]  ; FIXME


#<DoDDrilling> = 1
    #<DDrillToolNumber> = 7 ; FIXME: D drill (.246)
    #<DDrillSpeed> = 3000
    #<DDrillFeed> = [.246 * 100]  ; FIXME


#<Do.251Reaming> = 1
    #<.251ReamerToolNumber> = 8 ; FIXME: .251 reamer
    #<.251ReamerSpeed> = 400
    #<.251ReamerFeed> = [.251 * 100]  ; FIXME


#<DoUDrilling> = 1
    #<UDrillToolNumber> = 9 ; FIXME: U drill (.368)
    #<UDrillSpeed> = 3000
    #<UDrillFeed> = [.368 * 100]  ; FIXME


#<Do.376Reaming> = 1
    #<.376ReamerToolNumber> = 10 ; FIXME: .376 reamer
    #<.376ReamerSpeed> = 400
    #<.376ReamerFeed> = [.368 * 100]  ; FIXME


#<DoBoltReleaseSlot> = 1
    #<BoltReleaseSlotToolNumber> = 11 ; FIXME: 1/8 end mill
    #<BoltReleaseSlotSpeed> = 2500
    #<BoltReleaseSlotFeed> = 5


#<DoSafetyStops> = 1
    #<SafetyStopToolNumber> = 12 ; FIXME: 1/4 end mill
    #<SafetyStopSpeed> = 2500
    #<SafetyStopFeed> = 5


#<DoMagReleaseSlot> = 1
    #<MagReleaseSlotToolNumber> = 13 ; FIXME: 1/4 end mill
    #<MagReleaseSlotSpeed> = 2500
    #<MagReleaseSlotFeed> = 5


#<DoPistolGripPocket> = 1
    #<PistolGripPocketToolNumber> = 14 ; FIXME: 1/2 end mill
    #<PistolGripPocketSpeed> = 2000
    #<PistolGripPocketFeed> = 5




;
; 8 hole locations
;

; .251 reamed
#<PivotPinX> = 0.000
#<PivotPinY> = -0.000
#<PivotPinZTopOfWork> = 0.000  ; FIXME
#<PivotPinSpotZ> = [#<PivotPinZTopOfWork> - 0.050]  ; FIXME
#<PivotPinDrillZ> = #<ThroughZ> ; FIXME

; .251 reamed
#<TakedownPinX> = 6.375
#<TakedownPinY> = -0.000
#<TakedownPinZTopOfWork> = 0.000 ; FIXME
#<TakedownPinSpotZ> = [#<TakedownPinZTopOfWork> - 0.050] ; FIXME
#<TakedownPinDrillZ> = #<ThroughZ> ; FIXME

; .376 reamed
#<SafetySelectorX> = 5.572
#<SafetySelectorY> = -0.464
#<SafetySelectorZTopOfWork> = 0.000 ; FIXME
#<SafetySelectorSpotZ> = [#<SafetySelectorZTopOfWork> - 0.050] ; FIXME
#<SafetySelectorDrillZ> = #<ThroughZ> ; FIXME

; 5/32 reamed (.156)
#<TriggerHoleX> = 4.447
#<TriggerHoleY> = -0.689
#<TriggerHoleZTopOfWork> = 0.000 ; FIXME
#<TriggerHoleSpotZ> = [#<TriggerHoleZTopOfWork> - 0.050] ; FIXME
#<TriggerHoleDrillZ> = #<ThroughZ> ; FIXME

; 5/32 reamed (.156)
#<HammerHoleX> = 3.604
#<HammerHoleY> = -0.375
#<HammerHoleZTopOfWork> = 0.000 ; FIXME
#<HammerHoleSpotZ> = [#<HammerHoleZTopOfWork> - 0.050] ; FIXME
#<HammerHoleDrillZ> = #<ThroughZ> ; FIXME

; .125 drilled
; FIXME: the location of this hole differs in Ray's book vs the blueprint
#<RearTriggerGuardHoleX> = 4.8765  ; Ray says 4.875
#<RearTriggerGuardHoleY> = -2.180  ; Ray says 2.188
#<RearTriggerGuardHoleZTopOfWork> = 0.000 ; FIXME
#<RearTriggerGuardHoleSpotZ> = [#<RearTriggerGuardHoleZTopOfWork> - 0.050] ; FIXME
#<RearTriggerGuardHoleDrillZ> = #<ThroughZ> ; FIXME

; #5 drilled (.2055)
; FIXME: the location of this hole differs in Ray's book vs the blueprint
#<MagReleaseHoleX> = 3.084    ; Ray says 3.079
#<MagReleaseHoleY> = -0.5625  ; Ray says -0.563
#<MagReleaseHoleZTopOfWork> = 0.000 ; FIXME
#<MagReleaseHoleSpotZ> = [#<MagReleaseHoleZTopOfWork> - 0.050] ; FIXME
#<MagReleaseHoleDrillZ> = #<ThroughZ> ; FIXME

; 5/32 drilled (.156, not a through hole!)
#<BoltReleaseSpringHoleX> = 3.079
#<BoltReleaseSpringHoleY> = -0.194
#<BoltReleaseSpringHoleZTopOfWork> = 0.000 ; FIXME
#<BoltReleaseSpringHoleSpotZ> = [#<BoltReleaseSpringHoleZTopOfWork> - 0.050] ; FIXME
#<BoltReleaseSpringHoleDrillZ> = [-0.700]  ; FIXME: Ray says "1/32 past the centerline"




;
; the driver's side portion of the bolt release slot
; milled with a 1/8 end mill, slotted out to 0.167 +- .010
; In the blueprint, Section C-C specifies the lower Y dimension as .630-.250=.380
; FIXME: The lower Y of this slot is different in Ray's book vs the blueprint
; FIXME: also the width of the slot
;

#<BoltReleaseSlotCutterDiameter> = [1 / 8]
#<BoltReleaseSlotCutterRadius> = [#<BoltReleaseSlotCutterDiameter> / 2]

#<BoltReleaseSlotWidth> = 0.167

#<BoltReleaseSlotXCenter> =  #<BoltReleaseSpringHoleX>
#<BoltReleaseSlotLeftX> =  [ #<BoltReleaseSlotXCenter> - [ #<BoltReleaseSlotWidth> / 2 ]]
#<BoltReleaseSlotRightX> = [ #<BoltReleaseSlotXCenter> + [ #<BoltReleaseSlotWidth> / 2 ]]

#<BoltReleaseSlotKnobLowerY> = -.100  ; FIXME
#<BoltReleaseSlotLowerY> = -.380  ; FIXME: Ray says [-.279 - 5/64] = -.357125...
#<BoltReleaseSlotUpperY> = [ 0 + #<BoltReleaseSlotCutterRadius> + 0.010 ] ; move fully off the work

#<BoltReleaseSlotZKnobTop> = 0.750    ; FIXME
#<BoltReleaseSlotZSurfaceTop> = 0.500 ; FIXME
#<BoltReleaseSlotZBottom> = 0.250     ; FIXME




;
; the safety (aka fire selector) stops
; cut with whatever end mill is handy (Ray uses a 1/4)
;

#<SafetyStopCutterDiameter> = [1 / 4]
#<SafetyStopCutterRadius> = [#<SafetyStopCutterDiameter> / 2]

; FIXME: can't find the source of SafetyStopY in the blueprint
#<SafetyStopY> = [ -0.464 + [ 1/8 ]]

; FIXME: can't find these dimensions anywhere...
#<SafetyStopStartX> = [ 5.572 - 1 ]
#<SafetyStopEndX> = [ 5.572 + 1 ]

#<SafetyStopCutZ> = .500  ; FIXME




;
; the mag release slot
; plunge and cut with a 1/4" cutter, just move it in a straight line?
;

#<MagReleaseSlotCutterDiameter> = [1 / 4]
#<MagReleaseSlotCutterRadius> = [#<MagReleaseSlotCutterDiameter> / 2]

#<MagReleaseSlotY> = -0.5625         ; FIXME: Ray calls this -0.563

#<MagReleaseSlotLeftX> = 1.943       ; plunge here with a 1/4" cutter FIXME: Ray calls this 1.938
#<MagReleaseSlotKnobRightX> = 2.375  ; FIXME
#<MagReleaseSlotRightX> = 3.202      ; plunge here with a 1/4" cutter FIXME: Ray calls this 3.197

#<MagReleaseSlotTopZ> = 0.750        ; FIXME
#<MagReleaseSlotSurfaceZ> = 0.500    ; FIXME
#<MagReleaseSlotBottomZ> = [#<MagReleaseSlotSurfaceZ> - [5/32]]




;
; the pistol grip pocket
; NOTE: don't crash!
; NOTE: the Z for this requires a measurement from the forging...
;

#<PistolGripPocketCutterDiameter> = [1 / 2]
#<PistolGripPocketCutterRadius> = [#<PistolGripPocketCutterDiameter> / 2]

#<PistolGripPocketTopY> = -1.066
#<PistolGripPocketBottomY> = -2.000

#<PistolGripPocketLeftX> = 5.200  ; FIXME: Ray calls this 5.203
#<PistolGripPocketRightX> = 7.000 ; FIXME

#<PistolGripPocketTopZ> = .500    ; that's up from the centerline of the casting, FIXME: needs a measurement
#<PistolGripPocketBottomZ> = [3/16]  ; that's up from the centerline of the casting




o<init-0> call




o100 if [ #<DoSpotFaceBoltReleaseSpringHole> EQ 1 ] then

    ; fetch the spot-facing end mill
    m6 t#<SpotFaceBoltReleaseSpringHoleToolNumber> g43

    g0 x#<BoltReleaseSpringHoleX> y#<BoltReleaseSpringHoleY>

    m3 s#<SpotFaceSpeed>
    f#<SpotFaceFeed>
    (MSG, Set spindle speed to 2500 rpm)
    m1

    #<StartZ> = 0
    #<BottomZ> = -0.250
    o<helix-hole-2> call [#<BoltReleaseSpringHoleX>] [#<BoltReleaseSpringHoleY>] [#<BoltReleaseSlotWidth>] [#<StartZ>] [0.050] [#<BottomZ>] [#<SafeZ>]

o100 endif




o200 if [ #<DoSpotDrilling> EQ 1 ] then

    ; fetch the spot-drill
    m6 t#<SpotDrillToolNumber> g43

    m3 s#<SpotDrillSpeed>
    f#<SpotDrillFeed>
    (MSG, Set spindle speed to 3000 rpm)
    m1

    g81 x#<PivotPinX>              y#<PivotPinY>              z#<PivotPinSpotZ>              r[#<PivotPinZTopOfWork> + 0.025]
    g0 z#<SafeZ>
    g81 x#<TakedownPinX>           y#<TakedownPinY>           z#<TakedownPinSpotZ>           r[#<TakedownPinZTopOfWork> + 0.025]
    g0 z#<SafeZ>
    g81 x#<SafetySelectorX>        y#<SafetySelectorY>        z#<SafetySelectorSpotZ>        r[#<SafetySelectorZTopOfWork> + 0.025]
    g0 z#<SafeZ>
    g81 x#<TriggerHoleX>           y#<TriggerHoleY>           z#<TriggerHoleSpotZ>           r[#<TriggerHoleZTopOfWork> + 0.025]
    g0 z#<SafeZ>
    g81 x#<HammerHoleX>            y#<HammerHoleY>            z#<HammerHoleSpotZ>            r[#<HammerHoleZTopOfWork> + 0.025]
    g0 z#<SafeZ>
    g81 x#<RearTriggerGuardHoleX>  y#<RearTriggerGuardHoleY>  z#<RearTriggerGuardHoleSpotZ>  r[#<RearTriggerGuardHoleZTopOfWork> + 0.025]
    g0 z#<SafeZ>
    g81 x#<MagReleaseHoleX>        y#<MagReleaseHoleY>        z#<MagReleaseHoleSpotZ>        r[#<MagReleaseHoleZTopOfWork> + 0.025]
    g0 z#<SafeZ>
    g81 x#<BoltReleaseSpringHoleX> y#<BoltReleaseSpringHoleY> z#<BoltReleaseSpringHoleSpotZ> r[#<BoltReleaseSpringHoleZTopOfWork> + 0.025]
    g0 z#<SafeZ>

o200 endif




o300 if [ #<Do.125Drilling> EQ 1 ] then

    ; fetch the .125 drill
    m6 t#<.125DrillToolNumber> g43

    m3 s#<.125DrillSpeed>
    f#<.125DrillFeed>
    (MSG, Set spindle speed to 3000 rpm)
    m1

    #<PeckDepth> = 0.050

    g83 x#<PivotPinX>              y#<PivotPinY>              z#<PivotPinDrillZ>              r[#<PivotPinZTopOfWork> + 0.025]              q#<PeckDepth>
    g0 z#<SafeZ>
    g83 x#<TakedownPinX>           y#<TakedownPinY>           z#<TakedownPinDrillZ>           r[#<TakedownPinZTopOfWork> + 0.025]           q#<PeckDepth>
    g0 z#<SafeZ>
    g83 x#<SafetySelectorX>        y#<SafetySelectorY>        z#<SafetySelectorDrillZ>        r[#<SafetySelectorZTopOfWork> + 0.025]        q#<PeckDepth>
    g0 z#<SafeZ>
    g83 x#<TriggerHoleX>           y#<TriggerHoleY>           z#<TriggerHoleDrillZ>           r[#<TriggerHoleZTopOfWork> + 0.025]           q#<PeckDepth>
    g0 z#<SafeZ>
    g83 x#<HammerHoleX>            y#<HammerHoleY>            z#<HammerHoleDrillZ>            r[#<HammerHoleZTopOfWork> + 0.025]            q#<PeckDepth>
    g0 z#<SafeZ>
    g83 x#<RearTriggerGuardHoleX>  y#<RearTriggerGuardHoleY>  z#<RearTriggerGuardHoleDrillZ>  r[#<RearTriggerGuardHoleZTopOfWork> + 0.025]  q#<PeckDepth>
    g0 z#<SafeZ>
    g83 x#<MagReleaseHoleX>        y#<MagReleaseHoleY>        z#<MagReleaseHoleDrillZ>        r[#<MagReleaseHoleZTopOfWork> + 0.025]        q#<PeckDepth>
    g0 z#<SafeZ>
    g83 x#<BoltReleaseSpringHoleX> y#<BoltReleaseSpringHoleY> z#<BoltReleaseSpringHoleDrillZ> r[#<BoltReleaseSpringHoleZTopOfWork> + 0.025] q#<PeckDepth>
    g0 z#<SafeZ>

o300 endif




o400 if [ #<DoN24Drilling> EQ 1 ] then

    ; fetch the #24 drill
    m6 t#<N24DrillToolNumber> g43

    m3 s#<N24DrillSpeed>
    f#<N24DrillFeed>
    (MSG, Set spindle speed to 3000 rpm)
    m1

    #<PeckDepth> = 0.050

    g83 x#<PivotPinX>              y#<PivotPinY>              z#<PivotPinDrillZ>              r[#<PivotPinZTopOfWork> + 0.025]              q#<PeckDepth>
    g0 z#<SafeZ>
    g83 x#<TakedownPinX>           y#<TakedownPinY>           z#<TakedownPinDrillZ>           r[#<TakedownPinZTopOfWork> + 0.025]           q#<PeckDepth>
    g0 z#<SafeZ>
    g83 x#<SafetySelectorX>        y#<SafetySelectorY>        z#<SafetySelectorDrillZ>        r[#<SafetySelectorZTopOfWork> + 0.025]        q#<PeckDepth>
    g0 z#<SafeZ>
    g83 x#<TriggerHoleX>           y#<TriggerHoleY>           z#<TriggerHoleDrillZ>           r[#<TriggerHoleZTopOfWork> + 0.025]           q#<PeckDepth>
    g0 z#<SafeZ>
    g83 x#<HammerHoleX>            y#<HammerHoleY>            z#<HammerHoleDrillZ>            r[#<HammerHoleZTopOfWork> + 0.025]            q#<PeckDepth>
    g0 z#<SafeZ>
    g83 x#<MagReleaseHoleX>        y#<MagReleaseHoleY>        z#<MagReleaseHoleDrillZ>        r[#<MagReleaseHoleZTopOfWork> + 0.025]        q#<PeckDepth>
    g0 z#<SafeZ>
    g83 x#<BoltReleaseSpringHoleX> y#<BoltReleaseSpringHoleY> z#<BoltReleaseSpringHoleDrillZ> r[#<BoltReleaseSpringHoleZTopOfWork> + 0.025] q#<PeckDepth>
    g0 z#<SafeZ>

o400 endif




o500 if [ #<Do.156Reaming> EQ 1 ] then

    ; fetch the .156 reamer
    m6 t#<.156ReamerToolNumber> g43

    m3 s#<.156ReamerSpeed>
    f#<.156ReamerFeed>
    (MSG, Set spindle speed to FIXME rpm)
    m1

    g81 x#<TriggerHoleX>           y#<TriggerHoleY>           z#<TriggerHoleDrillZ>           r[#<TriggerHoleZTopOfWork> + 0.025]
    g0 z#<SafeZ>
    g81 x#<HammerHoleX>            y#<HammerHoleY>            z#<HammerHoleDrillZ>            r[#<HammerHoleZTopOfWork> + 0.025]
    g0 z#<SafeZ>
    g81 x#<BoltReleaseSpringHoleX> y#<BoltReleaseSpringHoleY> z#<BoltReleaseSpringHoleDrillZ> r[#<BoltReleaseSpringHoleZTopOfWork> + 0.025]
    g0 z#<SafeZ>

o500 endif




o600 if [ #<DoN5Drilling> EQ 1 ] then

    ; fetch the #5 drill
    m6 t#<N5DrillToolNumber> g43

    m3 s#<N5DrillSpeed>
    f#<N5DrillFeed>
    (MSG, Set spindle speed to FIXME rpm)
    m1

    g83 x#<PivotPinX>              y#<PivotPinY>              z#<PivotPinDrillZ>              r[#<PivotPinZTopOfWork> + 0.025]              q#<PeckDepth>
    g0 z#<SafeZ>
    g83 x#<TakedownPinX>           y#<TakedownPinY>           z#<TakedownPinDrillZ>           r[#<TakedownPinZTopOfWork> + 0.025]           q#<PeckDepth>
    g0 z#<SafeZ>
    g83 x#<SafetySelectorX>        y#<SafetySelectorY>        z#<SafetySelectorDrillZ>        r[#<SafetySelectorZTopOfWork> + 0.025]        q#<PeckDepth>
    g0 z#<SafeZ>
    g83 x#<MagReleaseHoleX>        y#<MagReleaseHoleY>        z#<MagReleaseHoleDrillZ>        r[#<MagReleaseHoleZTopOfWork> + 0.025]        q#<PeckDepth>
    g0 z#<SafeZ>

o600 endif




o700 if [ #<DoDDrilling> EQ 1 ] then

    ; fetch the D drill
    m6 t#<DDrillToolNumber> g43

    m3 s#<DDrillSpeed>
    f#<DDrillFeed>
    (MSG, Set spindle speed to FIXME rpm)
    m1

    g83 x#<PivotPinX>              y#<PivotPinY>              z#<PivotPinDrillZ>              r[#<PivotPinZTopOfWork> + 0.025]              q#<PeckDepth>
    g0 z#<SafeZ>
    g83 x#<TakedownPinX>           y#<TakedownPinY>           z#<TakedownPinDrillZ>           r[#<TakedownPinZTopOfWork> + 0.025]           q#<PeckDepth>
    g0 z#<SafeZ>
    g83 x#<SafetySelectorX>        y#<SafetySelectorY>        z#<SafetySelectorDrillZ>        r[#<SafetySelectorZTopOfWork> + 0.025]        q#<PeckDepth>
    g0 z#<SafeZ>

o700 endif




o800 if [ #<Do.251Reaming> EQ 1 ] then

    ; fetch the .251 reamer
    m6 t#<.251ReamerToolNumber> g43

    m3 s#<.251ReamerSpeed>
    f#<.251ReamerFeed>
    (MSG, Set spindle speed to FIXME rpm)
    m1

    g81 x#<PivotPinX>              y#<PivotPinY>              z#<PivotPinDrillZ>              r[#<PivotPinZTopOfWork> + 0.025]
    g0 z#<SafeZ>
    g81 x#<TakedownPinX>           y#<TakedownPinY>           z#<TakedownPinDrillZ>           r[#<TakedownPinZTopOfWork> + 0.025]
    g0 z#<SafeZ>

o800 endif




o900 if [ #<DoUDrilling> EQ 1 ] then

    ; fetch the U drill
    m6 t#<UDrillToolNumber> g43

    m3 s#<UDrillSpeed>
    f#<UDrillFeed>
    (MSG, Set spindle speed to FIXME rpm)
    m1

    g83 x#<SafetySelectorX>        y#<SafetySelectorY>        z#<SafetySelectorDrillZ>        r[#<SafetySelectorZTopOfWork> + 0.025]        q#<PeckDepth>
    g0 z#<SafeZ>

o900 endif




o1000 if [ #<Do.376Reaming> EQ 1 ] then

    ; fetch the .376 reamer
    m6 t#<.376ReamerToolNumber> g43

    m3 s#<.376ReamerSpeed>
    f#<.376ReamerFeed>
    (MSG, Set spindle speed to FIXME rpm)
    m1

    g81 x#<SafetySelectorX>        y#<SafetySelectorY>        z#<SafetySelectorDrillZ>        r[#<SafetySelectorZTopOfWork> + 0.025]
    g0 z#<SafeZ>

o1000 endif




o1100 if [ #<DoBoltReleaseSlot> EQ 1 ] then

    ; fetch the 1/8 end mill
    m6 t#<BoltReleaseSlotToolNumber> g43

    m3 s#<BoltReleaseSlotSpeed>
    f#<BoltReleaseSlotFeed>
    (MSG, Set spindle speed to 2500 rpm)
    m1

    ; ugh, manual cutter comp
    #<StartX> = [#<BoltReleaseSlotLeftX> + #<BoltReleaseSlotCutterRadius>]
    #<StartY> = #<BoltReleaseSlotUpperY>

    #<EndX> = [#<BoltReleaseSlotRightX>  - #<BoltReleaseSlotCutterRadius>]
    #<EndY> = [#<BoltReleaseSlotKnobLowerY> + #<BoltReleaseSlotCutterRadius>]

    #<ZTop> = #<BoltReleaseSlotZKnobTop>
    #<ZBottom> = #<BoltReleaseSlotZSurfaceTop>

    #<HorizontalDepthOfCut> = #<BoltReleaseSlotCutterRadius>
    #<VerticalDepthOfCut> = #<BoltReleaseSlotCutterRadius>

    #<FinishAllowance> = 0.010

    o<rectangular-pocket-1> call [#<StartX>] [#<StartY>] [#<EndX>] [#<EndY>] [#<ZTop>] [#<ZBottom>] [#<ZTop> + 0.100] [#<HorizontalDepthOfCut>] [#<VerticalDepthOfCut>] [#<FinishAllowance>]


    #<StartX> = [#<BoltReleaseSlotLeftX> + #<BoltReleaseSlotCutterRadius>]
    #<StartY> = #<BoltReleaseSlotUpperY>

    #<EndX> = [#<BoltReleaseSlotRightX>  - #<BoltReleaseSlotCutterRadius>]
    #<EndY> = [#<BoltReleaseSlotLowerY> + #<BoltReleaseSlotCutterRadius>]

    #<ZTop> = #<BoltReleaseSlotZSurfaceTop>
    #<ZBottom> = #<BoltReleaseSlotZBottom>

    #<HorizontalDepthOfCut> = #<BoltReleaseSlotCutterRadius>
    #<VerticalDepthOfCut> = #<BoltReleaseSlotCutterRadius>

    #<FinishAllowance> = 0.010

    o<rectangular-pocket-1> call [#<StartX>] [#<StartY>] [#<EndX>] [#<EndY>] [#<ZTop>] [#<ZBottom>] [#<BoltReleaseSlotZKnobTop> + 0.100] [#<HorizontalDepthOfCut>] [#<VerticalDepthOfCut>] [#<FinishAllowance>]

o1100 endif




o1200 if [ #<DoSafetyStops> EQ 1 ] then

    ; fetch the 1/8 end mill
    m6 t#<SafetyStopToolNumber> g43

    m3 s#<SafetyStopSpeed>
    f#<SafetyStopFeed>
    (MSG, Set spindle speed to 2500 rpm)
    m1

    g0 x#<SafetyStopStartX> y#<SafetyStopY>
    g0 z#<SafeZ>

    g1 z#<SafetyStopCutZ>
    g1 x#<SafetyStopEndX>

    g0 z#<SafeZ>

o1200 endif




o1300 if [ #<DoMagReleaseSlot> EQ 1 ] then

    ; fetch the 1/4 end mill
    m6 t#<MagReleaseSlotToolNumber> g43

    m3 s#<MagReleaseSlotSpeed>
    f#<MagReleaseSlotFeed>
    (MSG, Set spindle speed to 2500 rpm)
    m1

    g0 x#<MagReleaseSlotKnobRightX> y#<MagReleaseSlotY>
    g0 z#<SafeZ>

    g1 z#<MagReleaseSlotTopZ>


    ;
    ; cut the slot in the knob in three passes
    ;

    #<KnobHeight> = [#<MagReleaseSlotTopZ> - #<MagReleaseSlotSurfaceZ>]

    g1 z[#<MagReleaseSlotTopZ> - [[1/3] * #<KnobHeight>]]
    g1 x#<MagReleaseSlotLeftX>

    g1 z[#<MagReleaseSlotTopZ> - [[2/3] * #<KnobHeight>]]
    g1 x#<MagReleaseSlotKnobRightX>

    g1 z#<MagReleaseSlotSurfaceZ>
    g1 x#<MagReleaseSlotLeftX>


    ;
    ; cut the slot the rest of the way down in two passes
    ;

    g1 z[[#<MagReleaseSlotSurfaceZ> + #<MagReleaseSlotBottomZ>] / 2]
    g1 x#<MagReleaseSlotRightX>

    g1 z#<MagReleaseSlotBottomZ>
    g1 x#<MagReleaseSlotLeftX>


    g0 z#<SafeZ>

o1300 endif




o1400 if [ #<DoPistolGripPocket> EQ 1 ] then

    ; fetch the 1/2 end mill
    m6 t#<PistolGripPocketToolNumber> g43

    m3 s#<PistolGripPocketSpeed>
    f#<PistolGripPocketFeed>
    (MSG, Set spindle speed to 2000 rpm)
    m1

    #<StartX> = #<PistolGripPocketRightX>
    #<StartY> = [#<PistolGripPocketTopY> - #<PistolGripPocketCutterRadius>]

    #<EndX> = [#<PistolGripPocketLeftX> + #<PistolGripPocketCutterRadius>]
    #<EndY> = #<PistolGripPocketBottomY>

    #<ZTop> = #<PistolGripPocketTopZ>
    #<ZBottom> = #<PistolGripPocketBottomZ>

    #<HorizontalDepthOfCut> = #<PistolGripPocketCutterRadius>
    #<VerticalDepthOfCut> = #<PistolGripPocketCutterRadius>

    #<FinishAllowance> = 0.010

    o<rectangular-pocket-1> call [#<StartX>] [#<StartY>] [#<EndX>] [#<EndY>] [#<ZTop>] [#<ZBottom>] [#<ZTop> + 0.100] [#<HorizontalDepthOfCut>] [#<VerticalDepthOfCut>] [#<FinishAllowance>]

o1400 endif




;
; done!
;

;o<presentation-position-0> call
m2

